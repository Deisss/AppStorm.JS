(function(l,n){if("object"===typeof exports&&exports)n(exports);else{var t={};n(t);"function"===typeof define&&define.amd?define(t):l.Mustache=t}})(this,function(l){function n(a){return"function"===typeof a}function t(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function u(a){this.tail=this.string=a;this.pos=0}function m(a,b){this.view=null==a?{}:a;this.parent=b;this._cache={".":this.view}}function s(){this.clearCache()}function v(a,b,c,d){function h(a){return b.render(a,c)}for(var f= "",k,e,m=0,q=a.length;m<q;++m)switch(k=a[m],e=k[1],k[0]){case "#":e=c.lookup(e);if("object"===typeof e||"string"===typeof e)if(x(e))for(var g=0,p=e.length;g<p;++g)f+=v(k[4],b,c.push(e[g]),d);else e&&(f+=v(k[4],b,c.push(e),d));else n(e)?(k=null==d?null:d.slice(k[3],k[5]),e=e.call(c.view,k,h),null!=e&&(f+=e)):e&&(f+=v(k[4],b,c,d));break;case "^":e=c.lookup(e);if(!e||x(e)&&0===e.length)f+=v(k[4],b,c,d);break;case ">":e=b.getPartial(e);n(e)&&(f+=e(c));break;case "&":e=c.lookup(e);null!=e&&(f+=e);break; case "name":e=c.lookup(e);null!=e&&(f+=l.escape(e));break;case "text":f+=e}return f}function y(a){return[RegExp(t(a[0])+"\\s*"),RegExp("\\s*"+t(a[1]))]}var B=/\s*/,z=/\s+/,C=/\S/,A=/\s*=/,D=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/,F=RegExp.prototype.test,G=Object.prototype.toString,x=Array.isArray||function(a){return"[object Array]"===G.call(a)},H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};u.prototype.eos=function(){return""===this.tail};u.prototype.scan=function(a){return(a= this.tail.match(a))&&0===a.index?(a=a[0],this.tail=this.tail.substring(a.length),this.pos+=a.length,a):""};u.prototype.scanUntil=function(a){a=this.tail.search(a);var b;switch(a){case -1:b=this.tail;this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=b.length;return b};m.make=function(a){return a instanceof m?a:new m(a)};m.prototype.push=function(a){return new m(a,this)};m.prototype.lookup=function(a){var b;if(a in this._cache)b=this._cache[a]; else{for(var c=this;c;){if(0<a.indexOf(".")){b=c.view;for(var d=a.split("."),h=0;null!=b&&h<d.length;)b=b[d[h++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}n(b)&&(b=b.call(this.view));return b};s.prototype.clearCache=function(){this._cache={};this._partialCache={}};s.prototype.compile=function(a,b){var c=this._cache[a];c||(c=l.parse(a,b),c=this._cache[a]=this.compileTokens(c,a));return c};s.prototype.compilePartial=function(a,b,c){b=this.compile(b,c);return this._partialCache[a]= b};s.prototype.getPartial=function(a){a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a));return this._partialCache[a]};s.prototype.compileTokens=function(a,b){var c=this;return function(d,h){if(h)if(n(h))c._loadPartial=h;else for(var f in h)c.compilePartial(f,h[f]);return v(a,c,m.make(d),b)}};s.prototype.render=function(a,b,c){return this.compile(a)(b,c)};l.name="mustache.js";l.version="0.7.3";l.tags=["{{","}}"];l.Scanner=u;l.Context=m;l.Writer=s;l.parse=function(a, b){a=a||"";b=b||l.tags;"string"===typeof b&&(b=b.split(z));if(2!==b.length)throw Error("Invalid tags: "+b.join(", "));for(var c=y(b),d=new u(a),h=[],f=[],k=[],e=!1,m=!1,q,g,p,n;!d.eos();){q=d.pos;if(p=d.scanUntil(c[0])){n=0;for(var s=p.length;n<s;++n)if(g=p.charAt(n),F.call(C,g)?m=!0:k.push(f.length),f.push(["text",g,q,q+1]),q+=1,"\n"==g){if(e&&!m)for(;k.length;)delete f[k.pop()];else k=[];m=e=!1}}if(!d.scan(c[0]))break;e=!0;g=d.scan(E)||"name";d.scan(B);"="===g?(p=d.scanUntil(A),d.scan(A),d.scanUntil(c[1])): "{"===g?(p=d.scanUntil(RegExp("\\s*"+t("}"+b[1]))),d.scan(D),d.scanUntil(c[1]),g="&"):p=d.scanUntil(c[1]);if(!d.scan(c[1]))throw Error("Unclosed tag at "+d.pos);n=[g,p,q,d.pos];f.push(n);if("#"===g||"^"===g)h.push(n);else if("/"===g){g=h.pop();if(!g)throw Error('Unopened section "'+p+'" at '+q);if(g[1]!==p)throw Error('Unclosed section "'+g[1]+'" at '+q);}else if("name"===g||"{"===g||"&"===g)m=!0;else if("="===g){b=p.split(z);if(2!==b.length)throw Error("Invalid tags at "+q+": "+b.join(", "));c=y(b)}}if(g= h.pop())throw Error('Unclosed section "'+g[1]+'" at '+d.pos);for(var c=[],r,h=0,k=f.length;h<k;++h)if(d=f[h])"text"===d[0]&&r&&"text"===r[0]?(r[1]+=d[1],r[3]=d[3]):(r=d,c.push(d));r=f=[];d=[];k=0;for(e=c.length;k<e;++k)switch(h=c[k],h[0]){case "#":case "^":d.push(h);r.push(h);r=h[4]=[];break;case "/":d.pop()[5]=h[2];r=0<d.length?d[d.length-1][4]:f;break;default:r.push(h)}return f};l.escape=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return H[a]})};var w=new s;l.clearCache=function(){return w.clearCache()}; l.compile=function(a,b){return w.compile(a,b)};l.compilePartial=function(a,b,c){return w.compilePartial(a,b,c)};l.compileTokens=function(a,b){return w.compileTokens(a,b)};l.render=function(a,b,c){return w.render(a,b,c)};l.to_html=function(a,b,c,d){a=l.render(a,b,c);if(n(d))d(a);else return a}});